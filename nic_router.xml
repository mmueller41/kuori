<start name="nic_router" caps="200" brick="yes">
		<resource name="RAM" quantum="2G"/>
		<affinity xpos="2" ypos="0" width="1" height="1"/>
		<provides>
			<service name="Nic"/>
			<service name="Uplink"/>
		</provides>
		<config verbose_domain_state="false" max_packets_per_signal="1">

			<policy label_prefix="echo" domain="downlink"/>
			<policy label_prefix="kuori" domain="console"/> 
			<policy label_prefix="lighttpd" domain="upload"/>
			<policy label_prefix="drivers"   domain="uplink"/>
			<domain name="uplink" interface="10.0.2.55/24" gateway="10.0.2.1">
			<!--
			<domain name="uplink" interface="192.168.0.2/24" gateway="192.168.0.2" verbose_packets="no">
			-->

				<nat domain="downlink"
				     tcp-ports="16384"
				     udp-ports="16384"
				     icmp-ids="16384"/>

				<nat domain="console"
				 tcp-ports="16384"
				 udp-ports="16384"
				 icmp-ids="16384"/>

				<nat domain="upload"
				 tcp-ports="16384"
				 udp-ports="16384"
				 icmp-ids="16384"/>

				<tcp-forward port="12345" domain="downlink" to="10.0.3.55"/>
				<tcp-forward port="8080" domain="console" to="10.0.1.55"/>

				<udp-forward port="7"    domain="downlink" to="10.0.3.55"/>
				<udp-forward port="7070" domain="downlink" to="10.0.3.55"/>

				<tcp-forward port="80" domain="upload" to="10.0.4.55"/>

			</domain>

			<domain name="console" interface="10.0.1.1/24">
				<dhcp-server ip_first="10.0.1.55" ip_last="10.0.1.55">
					<dns-server ip="8.8.8.8"/>
				</dhcp-server>

				<tcp dst="0.0.0.0/0"><permit-any domain="uplink" /></tcp>
				<udp dst="0.0.0.0/0"><permit-any domain="uplink" /></udp>
				<icmp dst="0.0.0.0/0" domain="uplink"/>
			</domain>
			
			<domain name="upload" interface="10.0.4.1/24">
				<dhcp-server ip_first="10.0.4.55" ip_last="10.0.4.55">
					<dns-server ip="8.8.8.8"/>
				</dhcp-server>

				<tcp dst="0.0.0.0/0"><permit-any domain="uplink" /></tcp>
				<udp dst="0.0.0.0/0"><permit-any domain="uplink" /></udp>
				<icmp dst="0.0.0.0/0" domain="uplink"/>
			</domain>

			<domain name="downlink" interface="10.0.3.1/24" verbose_packets="no">

				<dhcp-server ip_first="10.0.3.55" ip_last="10.0.3.55">
					<dns-server ip="8.8.8.8"/>
					<dns-server ip="1.1.1.1"/>
				</dhcp-server>

				<tcp dst="0.0.0.0/0"><permit-any domain="uplink" /></tcp>
				<udp dst="0.0.0.0/0"><permit-any domain="uplink" /></udp>
				<icmp dst="0.0.0.0/0" domain="uplink"/>

			</domain>

		</config>
	</start>
